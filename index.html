<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜ ç”»è¨ºæ–­ã‚¢ãƒ—ãƒª</title>
  <meta name="theme-color" content="#7c3aed">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap');
    
    * { -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Montserrat', sans-serif; background: #0a0a0a; overscroll-behavior: none; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .loading { animation: pulse 1.5s ease-in-out infinite; }
    .cinema-bg { background: linear-gradient(to bottom, #0a0a0a, #1a0a2e); }
    .glass { background: rgba(26, 26, 26, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(139, 92, 246, 0.3); }
    .btn-primary { background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); transition: all 0.3s ease; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(124, 58, 237, 0.4); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 40px rgba(124, 58, 237, 0.3); }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { animation: spin 1s linear infinite; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a1a1a; }
    ::-webkit-scrollbar-thumb { background: #7c3aed; border-radius: 4px; }
    .touch-feedback:active { transform: scale(0.95); opacity: 0.8; }
    .modal-overlay { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function MovieFinderApp() {
      const [view, setView] = useState('home');
      const [step, setStep] = useState(0);
      const [answers, setAnswers] = useState({});
      const [movie, setMovie] = useState(null);
      const [loading, setLoading] = useState(false);
      const [favorites, setFavorites] = useState([]);
      const [history, setHistory] = useState([]);
      const [dailyCount, setDailyCount] = useState(0);
      const [showGuide, setShowGuide] = useState(false);

      useEffect(() => {
        const savedFavorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const savedHistory = JSON.parse(localStorage.getItem('history') || '[]');
        setFavorites(savedFavorites);
        setHistory(savedHistory);
        updateDailyCount();
      }, []);

      const updateDailyCount = () => {
        const today = new Date().toDateString();
        let usage = JSON.parse(localStorage.getItem('dailyUsage') || '{}');
        if (usage.date !== today) {
          usage = { date: today, count: 0 };
        }
        setDailyCount(usage.count);
        return usage.count;
      };

      const questions = [
        { id: 'type', question: 'ã‚¢ãƒ‹ãƒ¡ï¼Ÿå®Ÿå†™ï¼Ÿ', icon: 'ğŸ¬', options: [
          { value: 'anime', label: 'ã‚¢ãƒ‹ãƒ¡', emoji: 'ğŸ¨' },
          { value: 'live', label: 'å®Ÿå†™', emoji: 'ğŸ­' },
          { value: 'any', label: 'ã©ã¡ã‚‰ã§ã‚‚', emoji: 'âœ¨' }
        ]},
        { id: 'language', question: 'è¨€èªã¯ï¼Ÿ', icon: 'ğŸŒ', options: [
          { value: 'ja', label: 'æ—¥æœ¬èª', emoji: 'ğŸ‡¯ğŸ‡µ' },
          { value: 'en', label: 'è‹±èª', emoji: 'ğŸ‡ºğŸ‡¸' },
          { value: 'ko', label: 'éŸ“å›½èª', emoji: 'ğŸ‡°ğŸ‡·' },
          { value: 'any', label: 'ã©ã‚Œã§ã‚‚', emoji: 'ğŸŒ' }
        ]},
        { id: 'genre', question: 'å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«ã¯ï¼Ÿ', icon: 'ğŸ¯', options: [
          { value: 'action', label: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', emoji: 'ğŸ’¥' },
          { value: 'comedy', label: 'ã‚³ãƒ¡ãƒ‡ã‚£', emoji: 'ğŸ˜‚' },
          { value: 'horror', label: 'ãƒ›ãƒ©ãƒ¼', emoji: 'ğŸ‘»' },
          { value: 'romance', label: 'æ‹æ„›', emoji: 'ğŸ’•' },
          { value: 'scifi', label: 'SF', emoji: 'ğŸš€' },
          { value: 'drama', label: 'ãƒ‰ãƒ©ãƒ', emoji: 'ğŸ­' },
          { value: 'thriller', label: 'ã‚¹ãƒªãƒ©ãƒ¼', emoji: 'ğŸ”ª' },
          { value: 'fantasy', label: 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', emoji: 'ğŸ§™' }
        ]},
        { id: 'award', question: 'ã©ã‚“ãªä½œå“ï¼Ÿ', icon: 'ğŸ†', options: [
          { value: 'award', label: 'å—è³ä½œå“', emoji: 'ğŸ†' },
          { value: 'popular', label: 'äººæ°—ä½œå“', emoji: 'ğŸ”¥' },
          { value: 'hidden', label: 'éš ã‚ŒãŸåä½œ', emoji: 'ğŸ’' },
          { value: 'any', label: 'ã©ã‚Œã§ã‚‚', emoji: 'âœ¨' }
        ]},
        { id: 'decade', question: 'ä½•å¹´ä»£ï¼Ÿ', icon: 'ğŸ“…', options: [
          { value: '1990s', label: '90å¹´ä»£ä»¥å‰', emoji: 'ğŸ“¼' },
          { value: '2000s', label: '00å¹´ä»£', emoji: 'ğŸ’¿' },
          { value: '2010s', label: '10å¹´ä»£', emoji: 'ğŸ“±' },
          { value: '2020s', label: '20å¹´ä»£', emoji: 'ğŸ†•' },
          { value: 'any', label: 'ã©ã‚Œã§ã‚‚', emoji: 'â™¾ï¸' }
        ]},
        { id: 'runtime', question: 'è¦–è´æ™‚é–“ã¯ï¼Ÿ', icon: 'â±ï¸', options: [
          { value: 'short', label: 'çŸ­ã‚', emoji: 'âš¡' },
          { value: 'medium', label: 'æ™®é€š', emoji: 'â°' },
          { value: 'long', label: 'é•·ã‚', emoji: 'ğŸ“º' },
          { value: 'any', label: 'æ°—ã«ã—ãªã„', emoji: 'âˆ' }
        ]},
        { id: 'mood', question: 'ä»Šã®æ°—åˆ†ã¯ï¼Ÿ', icon: 'ğŸ˜Š', options: [
          { value: 'exciting', label: 'ãƒ¯ã‚¯ãƒ¯ã‚¯', emoji: 'ğŸ‰' },
          { value: 'calm', label: 'ã—ã£ã¨ã‚Š', emoji: 'ğŸŒ™' },
          { value: 'thrilling', label: 'ãƒãƒ©ãƒãƒ©', emoji: 'ğŸ˜±' },
          { value: 'funny', label: 'ç¬‘ã„ãŸã„', emoji: 'ğŸ˜‚' }
        ]},
        { id: 'setting', question: 'èˆå°ã¯ï¼Ÿ', icon: 'ğŸŒ', options: [
          { value: 'modern', label: 'ç¾ä»£', emoji: 'ğŸ™ï¸' },
          { value: 'past', label: 'éå»', emoji: 'ğŸ°' },
          { value: 'future', label: 'æœªæ¥', emoji: 'ğŸš€' },
          { value: 'any', label: 'ã©ã‚Œã§ã‚‚', emoji: 'ğŸŒ' }
        ]},
        { id: 'mbti', question: 'ã‚ãªãŸã®MBTIã¯ï¼Ÿ', icon: 'ğŸ§ ', options: [
          { value: 'INTJ', label: 'INTJ', emoji: 'ğŸ”¬', desc: 'å»ºç¯‰å®¶' },
          { value: 'INTP', label: 'INTP', emoji: 'ğŸ¤”', desc: 'è«–ç†å­¦è€…' },
          { value: 'ENTJ', label: 'ENTJ', emoji: 'ğŸ‘”', desc: 'æŒ‡æ®å®˜' },
          { value: 'ENTP', label: 'ENTP', emoji: 'ğŸ’¡', desc: 'è¨è«–è€…' },
          { value: 'INFJ', label: 'INFJ', emoji: 'ğŸŒŸ', desc: 'æå”±è€…' },
          { value: 'INFP', label: 'INFP', emoji: 'ğŸ¨', desc: 'ä»²ä»‹è€…' },
          { value: 'ENFJ', label: 'ENFJ', emoji: 'ğŸ¤', desc: 'ä¸»äººå…¬' },
          { value: 'ENFP', label: 'ENFP', emoji: 'ğŸ‰', desc: 'åºƒå ±é‹å‹•å®¶' },
          { value: 'ISTJ', label: 'ISTJ', emoji: 'ğŸ“‹', desc: 'ç®¡ç†è€…' },
          { value: 'ISFJ', label: 'ISFJ', emoji: 'ğŸ›¡ï¸', desc: 'æ“è­·è€…' },
          { value: 'ESTJ', label: 'ESTJ', emoji: 'âš–ï¸', desc: 'å¹¹éƒ¨' },
          { value: 'ESFJ', label: 'ESFJ', emoji: 'ğŸ¤—', desc: 'é ˜äº‹å®˜' },
          { value: 'ISTP', label: 'ISTP', emoji: 'ğŸ”§', desc: 'å·¨åŒ ' },
          { value: 'ISFP', label: 'ISFP', emoji: 'ğŸ­', desc: 'å†’é™ºå®¶' },
          { value: 'ESTP', label: 'ESTP', emoji: 'âš¡', desc: 'èµ·æ¥­å®¶' },
          { value: 'ESFP', label: 'ESFP', emoji: 'ğŸª', desc: 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒŠãƒ¼' },
          { value: 'unknown', label: 'åˆ†ã‹ã‚‰ãªã„', emoji: 'â“', desc: 'ã‚¹ã‚­ãƒƒãƒ—' }
        ]},
        { id: 'with', question: 'èª°ã¨è¦‹ã‚‹ï¼Ÿ', icon: 'ğŸ‘¥', options: [
          { value: 'alone', label: 'ä¸€äºº', emoji: 'ğŸ™‹' },
          { value: 'friends', label: 'å‹é”', emoji: 'ğŸ‘¯' },
          { value: 'partner', label: 'æ‹äºº', emoji: 'ğŸ’‘' },
          { value: 'family', label: 'å®¶æ—', emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' }
        ]}
      ];

      const handleAnswer = (questionId, value) => {
        setAnswers(prev => ({ ...prev, [questionId]: value }));
        if (step < questions.length - 1) {
          setTimeout(() => setStep(step + 1), 200);
        }
      };

      const findMovie = async () => {
        const currentCount = updateDailyCount();
        if (currentCount >= 3) {
          alert('æœ¬æ—¥ã®è¨ºæ–­å›æ•°ãŒä¸Šé™(3å›)ã«é”ã—ã¾ã—ãŸã€‚\næ˜æ—¥0æ™‚ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ ğŸ•');
          return;
        }
        setLoading(true);
        try {
          const response = await fetch('/api/movies', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ answers })
          });
          const data = await response.json();
          if (data.error) {
            alert(data.error);
            setLoading(false);
            return;
          }
          
          // æ¡ä»¶ç·©å’Œé€šçŸ¥
          if (data.fallback) {
            alert(`ğŸ“¢ ãŠçŸ¥ã‚‰ã›\n\n${data.fallbackReason}\n\nã‚ãªãŸã«ãŠã™ã™ã‚ã®æ˜ ç”»ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼`);
          }
          
          const today = new Date().toDateString();
          let usage = JSON.parse(localStorage.getItem('dailyUsage') || '{}');
          usage = { date: today, count: currentCount + 1 };
          localStorage.setItem('dailyUsage', JSON.stringify(usage));
          setDailyCount(usage.count);
          const newHistory = [data, ...history].slice(0, 50);
          setHistory(newHistory);
          localStorage.setItem('history', JSON.stringify(newHistory));
          setMovie(data);
          setView('result');
        } catch (error) {
          alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      const toggleFavorite = (movieToSave) => {
        const isFavorite = favorites.some(f => f.title === movieToSave.title);
        if (isFavorite) {
          const newFavorites = favorites.filter(f => f.title !== movieToSave.title);
          setFavorites(newFavorites);
          localStorage.setItem('favorites', JSON.stringify(newFavorites));
        } else {
          const newFavorites = [movieToSave, ...favorites];
          setFavorites(newFavorites);
          localStorage.setItem('favorites', JSON.stringify(newFavorites));
        }
      };

      const shareMovie = (platform) => {
        const text = `ç§ã«ãƒ”ãƒƒã‚¿ãƒªã®æ˜ ç”»ã¯ã€Œ${movie.title}ã€ã§ã—ãŸï¼ğŸ¬\n\nã‚ãªãŸã‚‚è¨ºæ–­ã—ã¦ã¿ã¦ğŸ‘‡`;
        const url = window.location.href.split('?')[0];
        if (platform === 'twitter') {
          window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
        } else if (platform === 'line') {
          window.open(`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`, '_blank');
        } else if (platform === 'copy') {
          navigator.clipboard.writeText(`${text}\n${url}`);
          alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ğŸ“‹');
        }
      };

      const reset = () => {
        setStep(0);
        setAnswers({});
        setMovie(null);
        setView('home');
      };

      const startQuiz = () => {
        if (dailyCount >= 3) {
          alert('æœ¬æ—¥ã®è¨ºæ–­å›æ•°ãŒä¸Šé™(3å›)ã«é”ã—ã¾ã—ãŸã€‚');
          return;
        }
        setView('quiz');
        setStep(0);
        setAnswers({});
      };

      const currentQuestion = questions[step];
      const allAnswered = Object.keys(answers).length === questions.length;
      const progress = ((step + 1) / questions.length) * 100;

      if (view === 'home') {
        return (
          <div className="min-h-screen cinema-bg p-4">
            <div className="max-w-4xl mx-auto pt-8 pb-24">
              <div className="text-center mb-12 fade-in">
                <div className="text-6xl mb-4">ğŸ¬</div>
                <h1 className="text-5xl md:text-7xl font-black mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                  MOVIE FINDER
                </h1>
                <p className="text-purple-300 text-lg md:text-xl">
                  10ã®è³ªå•ã§ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®æ˜ ç”»ã‚’è¦‹ã¤ã‘ã‚ˆã†
                </p>
                <p className="text-purple-400 text-sm mt-2">
                  ğŸ§  MBTIå¯¾å¿œï¼ã‚ãªãŸã®æ€§æ ¼ã‚¿ã‚¤ãƒ—ã‹ã‚‰è¨ºæ–­
                </p>
              </div>
              <div className="glass rounded-2xl p-6 mb-8 fade-in">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-purple-400 text-sm mb-1">æœ¬æ—¥ã®è¨ºæ–­å›æ•°</p>
                    <p className="text-white text-3xl font-black">{dailyCount} <span className="text-lg text-gray-400">/ 3å›</span></p>
                  </div>
                  <div className="text-5xl">{dailyCount >= 3 ? 'ğŸ”’' : 'âœ¨'}</div>
                </div>
                {dailyCount >= 3 && (
                  <p className="text-gray-400 text-sm mt-3">æ˜æ—¥0æ™‚ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™</p>
                )}
              </div>
              <button onClick={startQuiz} disabled={dailyCount >= 3} className={`w-full btn-primary text-white py-6 rounded-2xl font-black text-xl mb-6 shadow-2xl ${dailyCount >= 3 ? 'opacity-50 cursor-not-allowed' : 'touch-feedback'}`}>
                {dailyCount >= 3 ? 'æœ¬æ—¥ã®è¨ºæ–­ã¯çµ‚äº†ã—ã¾ã—ãŸ' : 'è¨ºæ–­ã‚’å§‹ã‚ã‚‹ ğŸ¯'}
              </button>
              <div className="grid grid-cols-2 gap-4">
                <button onClick={() => setView('favorites')} className="glass p-6 rounded-xl text-center touch-feedback card-hover">
                  <div className="text-4xl mb-2">â­</div>
                  <p className="text-white font-bold">ãŠæ°—ã«å…¥ã‚Š</p>
                  <p className="text-purple-400 text-sm">{favorites.length}ä»¶</p>
                </button>
                <button onClick={() => setView('history')} className="glass p-6 rounded-xl text-center touch-feedback card-hover">
                  <div className="text-4xl mb-2">ğŸ“œ</div>
                  <p className="text-white font-bold">å±¥æ­´</p>
                  <p className="text-purple-400 text-sm">{history.length}ä»¶</p>
                </button>
              </div>
              <button onClick={() => setShowGuide(true)} className="w-full glass p-4 rounded-xl mt-6 text-purple-400 font-bold touch-feedback">
                ğŸ“– ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰
              </button>
            </div>
            {showGuide && (
              <div className="fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50" onClick={() => setShowGuide(false)}>
                <div className="glass rounded-2xl p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-2xl font-black text-white">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
                    <button onClick={() => setShowGuide(false)} className="text-3xl text-white">âœ•</button>
                  </div>
                  <div className="space-y-4 text-gray-300">
                    <div>
                      <p className="font-bold text-purple-400 mb-2">1. è¨ºæ–­ã‚’å§‹ã‚ã‚‹</p>
                      <p className="text-sm">ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã€Œè¨ºæ–­ã‚’å§‹ã‚ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—</p>
                    </div>
                    <div>
                      <p className="font-bold text-purple-400 mb-2">2. è³ªå•ã«ç­”ãˆã‚‹</p>
                      <p className="text-sm">10ã®è³ªå•ã«ç›´æ„Ÿã§ç­”ãˆã¦ãã ã•ã„</p>
                    </div>
                    <div>
                      <p className="font-bold text-purple-400 mb-2">3. æ˜ ç”»ã‚’ç™ºè¦‹</p>
                      <p className="text-sm">ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®æ˜ ç”»ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼</p>
                    </div>
                  </div>
                  <button onClick={() => setShowGuide(false)} className="w-full btn-primary text-white py-3 rounded-xl font-bold mt-6">
                    é–‰ã˜ã‚‹
                  </button>
                </div>
              </div>
            )}
          </div>
        );
      }

      if (view === 'quiz' && !loading) {
        return (
          <div className="min-h-screen cinema-bg p-4">
            <div className="max-w-3xl mx-auto pt-8">
              <div className="mb-6">
                <div className="flex justify-between text-purple-400 font-bold mb-2 text-sm">
                  <span>STEP {step + 1} / {questions.length}</span>
                  <span>{Math.round(progress)}%</span>
                </div>
                <div className="w-full bg-gray-900 rounded-full h-3 overflow-hidden border border-purple-500/30">
                  <div className="h-full bg-gradient-to-r from-purple-600 to-pink-600 transition-all duration-300 rounded-full" style={{ width: `${progress}%` }}></div>
                </div>
              </div>
              <div className="glass rounded-3xl p-6 md:p-10 fade-in">
                <div className="text-center mb-8">
                  <div className="text-6xl mb-4">{currentQuestion.icon}</div>
                  <h2 className="text-3xl md:text-4xl font-black text-white mb-2">{currentQuestion.question}</h2>
                  <p className="text-purple-400 text-sm">ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠã—ã¦ãã ã•ã„</p>
                </div>
                <div className={`grid gap-3 mb-6 ${currentQuestion.options.length > 6 ? 'grid-cols-2 md:grid-cols-3' : 'grid-cols-1 md:grid-cols-2'}`}>
                  {currentQuestion.options.map(option => (
                    <button key={option.value} onClick={() => handleAnswer(currentQuestion.id, option.value)}
                      className={`p-5 rounded-xl font-bold transition-all touch-feedback ${answers[currentQuestion.id] === option.value ? 'bg-gradient-to-br from-purple-600 to-pink-600 text-white scale-105 shadow-xl' : 'glass text-white hover:bg-purple-900/30'}`}>
                      <div className="text-4xl mb-2">{option.emoji}</div>
                      <div className="text-lg">{option.label}</div>
                      {option.desc && <div className="text-xs opacity-80 mt-1">{option.desc}</div>}
                    </button>
                  ))}
                </div>
                <div className="flex gap-3">
                  <button onClick={reset} className="flex-1 glass text-purple-400 py-4 rounded-xl font-bold touch-feedback">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
                  {allAnswered && <button onClick={findMovie} className="flex-2 btn-primary text-white py-4 rounded-xl font-black text-lg touch-feedback flex items-center justify-center gap-2"><span>æ˜ ç”»ã‚’æ¢ã™</span><span className="text-2xl">ğŸ¬</span></button>}
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (loading) {
        return (
          <div className="min-h-screen cinema-bg flex items-center justify-center p-4">
            <div className="text-center fade-in">
              <div className="w-32 h-32 border-8 border-purple-900 border-t-purple-500 rounded-full spinner mx-auto mb-8"></div>
              <h2 className="text-3xl font-black text-purple-400 mb-4 loading">NOW LOADING</h2>
              <p className="text-purple-300">ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®æ˜ ç”»ã‚’æ¢ã—ã¦ã„ã¾ã™...</p>
            </div>
          </div>
        );
      }

      if (view === 'result' && movie) {
        const isFavorite = favorites.some(f => f.title === movie.title);
        return (
          <div className="min-h-screen cinema-bg p-4">
            <div className="max-w-4xl mx-auto pt-8 pb-24 fade-in">
              <div className="glass rounded-3xl overflow-hidden">
                <div className="bg-gradient-to-r from-purple-900/50 to-pink-900/50 px-6 py-4 border-b border-purple-500/30">
                  <h2 className="text-2xl font-black text-white">YOUR MOVIE ğŸ¬</h2>
                  <p className="text-purple-300 text-sm">ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®æ˜ ç”»</p>
                </div>
                <div className="p-6">
                  <div className="grid md:grid-cols-5 gap-6">
                    <div className="md:col-span-2">
                      <div className="relative">
                        <img src={movie.poster} alt={movie.title} className="w-full rounded-xl shadow-2xl" />
                        <button onClick={() => toggleFavorite(movie)} className="absolute top-4 right-4 w-12 h-12 rounded-full glass flex items-center justify-center text-2xl touch-feedback">
                          {isFavorite ? 'â­' : 'â˜†'}
                        </button>
                      </div>
                    </div>
                    <div className="md:col-span-3">
                      <h3 className="text-3xl md:text-4xl font-black text-white mb-4">{movie.title}</h3>
                      <div className="grid grid-cols-3 gap-3 mb-6">
                        <div className="glass p-4 rounded-xl text-center">
                          <p className="text-purple-400 text-xs mb-1">å…¬é–‹å¹´</p>
                          <p className="text-white text-2xl font-black">{movie.year}</p>
                        </div>
                        <div className="glass p-4 rounded-xl text-center">
                          <p className="text-purple-400 text-xs mb-1">è©•ä¾¡</p>
                          <p className="text-yellow-400 text-2xl font-black">{movie.rating}</p>
                        </div>
                        <div className="glass p-4 rounded-xl text-center">
                          <p className="text-purple-400 text-xs mb-1">æ™‚é–“</p>
                          <p className="text-white text-2xl font-black">{movie.runtime}åˆ†</p>
                        </div>
                      </div>
                      {movie.genres && (
                        <div className="mb-4">
                          <span className="glass px-4 py-2 rounded-full text-purple-300 text-sm inline-block">{movie.genres}</span>
                        </div>
                      )}
                      <div className="glass p-4 rounded-xl mb-6">
                        <p className="text-gray-300 text-sm leading-relaxed">{movie.desc}</p>
                      </div>
                      <div className="grid grid-cols-3 gap-2 mb-4">
                        <button onClick={() => shareMovie('twitter')} className="glass p-3 rounded-xl text-center touch-feedback hover:bg-blue-500/20">
                          <div className="text-2xl mb-1">ğŸ¦</div>
                          <p className="text-xs text-white font-bold">Twitter</p>
                        </button>
                        <button onClick={() => shareMovie('line')} className="glass p-3 rounded-xl text-center touch-feedback hover:bg-green-500/20">
                          <div className="text-2xl mb-1">ğŸ’¬</div>
                          <p className="text-xs text-white font-bold">LINE</p>
                        </button>
                        <button onClick={() => shareMovie('copy')} className="glass p-3 rounded-xl text-center touch-feedback hover:bg-purple-500/20">
                          <div className="text-2xl mb-1">ğŸ“‹</div>
                          <p className="text-xs text-white font-bold">ã‚³ãƒ”ãƒ¼</p>
                        </button>
                      </div>
                      <button onClick={reset} className="w-full btn-primary text-white py-4 rounded-xl font-black touch-feedback">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
                    </div>
                  </div>
                </div>
              </div>
              <div className="glass rounded-xl p-4 mt-6 text-center">
                <p className="text-purple-400 text-sm">æœ¬æ—¥ã®è¨ºæ–­å›æ•°: {dailyCount} / 3å›</p>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'favorites') {
        return (
          <div className="min-h-screen cinema-bg p-4">
            <div className="max-w-4xl mx-auto pt-8 pb-24">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-3xl font-black text-white">â­ ãŠæ°—ã«å…¥ã‚Š</h2>
                <button onClick={() => setView('home')} className="glass px-4 py-2 rounded-xl text-purple-400 font-bold touch-feedback">â† ãƒ›ãƒ¼ãƒ </button>
              </div>
              {favorites.length === 0 ? (
                <div className="glass rounded-2xl p-12 text-center">
                  <div className="text-6xl mb-4">ğŸ“­</div>
                  <p className="text-gray-400 text-lg">ãŠæ°—ã«å…¥ã‚ŠãŒã‚ã‚Šã¾ã›ã‚“</p>
                  <button onClick={() => setView('home')} className="btn-primary text-white px-6 py-3 rounded-xl font-bold mt-6 touch-feedback">è¨ºæ–­ã‚’å§‹ã‚ã‚‹</button>
                </div>
              ) : (
                <div className="grid md:grid-cols-2 gap-4">
                  {favorites.map((fav, index) => (
                    <div key={index} className="glass rounded-xl p-4 card-hover">
                      <div className="flex gap-4">
                        <img src={fav.poster} alt={fav.title} className="w-24 h-36 object-cover rounded-lg" />
                        <div className="flex-1">
                          <h3 className="text-white font-bold text-lg mb-2 line-clamp-2">{fav.title}</h3>
                          <div className="flex gap-2 text-sm mb-2">
                            <span className="text-purple-400">{fav.year}</span>
                            <span className="text-gray-400">â€¢</span>
                            <span className="text-yellow-400">â­ {fav.rating}</span>
                          </div>
                          <button onClick={() => toggleFavorite(fav)} className="text-purple-400 text-sm font-bold touch-feedback">å‰Šé™¤ âœ•</button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      }

      if (view === 'history') {
        return (
          <div className="min-h-screen cinema-bg p-4">
            <div className="max-w-4xl mx-auto pt-8 pb-24">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-3xl font-black text-white">ğŸ“œ å±¥æ­´</h2>
                <button onClick={() => setView('home')} className="glass px-4 py-2 rounded-xl text-purple-400 font-bold touch-feedback">â† ãƒ›ãƒ¼ãƒ </button>
              </div>
              {history.length === 0 ? (
                <div className="glass rounded-2xl p-12 text-center">
                  <div className="text-6xl mb-4">ğŸ“­</div>
                  <p className="text-gray-400 text-lg">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                  <button onClick={() => setView('home')} className="btn-primary text-white px-6 py-3 rounded-xl font-bold mt-6 touch-feedback">è¨ºæ–­ã‚’å§‹ã‚ã‚‹</button>
                </div>
              ) : (
                <div className="space-y-4">
                  {history.map((item, index) => (
                    <div key={index} className="glass rounded-xl p-4 card-hover">
                      <div className="flex gap-4">
                        <img src={item.poster} alt={item.title} className="w-24 h-36 object-cover rounded-lg" />
                        <div className="flex-1">
                          <h3 className="text-white font-bold text-lg mb-2">{item.title}</h3>
                          <div className="flex gap-2 text-sm mb-3">
                            <span className="text-purple-400">{item.year}</span>
                            <span className="text-gray-400">â€¢</span>
                            <span className="text-yellow-400">â­ {item.rating}</span>
                            <span className="text-gray-400">â€¢</span>
                            <span className="text-gray-400">{item.runtime}åˆ†</span>
                          </div>
                          <p className="text-gray-400 text-sm line-clamp-2">{item.desc}</p>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<MovieFinderApp />, document.getElementById('root'));
  </script>

  <footer style="background: linear-gradient(to top, #0a0a0a, transparent); position: fixed; bottom: 0; left: 0; right: 0; padding: 1rem; text-align: center; border-top: 1px solid rgba(139, 92, 246, 0.2); backdrop-filter: blur(10px);">
    <p style="color: #a78bfa; font-size: 0.75rem; margin-bottom: 0.25rem;">
      ã“ã®ã‚¢ãƒ—ãƒªã¯<a href="https://www.themoviedb.org/" target="_blank" style="color: #c084fc; text-decoration: underline;">TMDB</a> APIã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€TMDBã«ã‚ˆã£ã¦æ‰¿èªã•ã‚ŒãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“
    </p>
    <p style="color: #6b7280; font-size: 0.625rem;">Powered by TMDB</p>
  </footer>
</body>
</html>
